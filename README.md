Refactor of code from <https://gist.github.com/rust-play/7daffbaa17ab8fd4ee55f031074e3d46>
